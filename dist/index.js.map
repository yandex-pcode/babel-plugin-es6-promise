{"version":3,"sources":["../src/index.js"],"names":["api","pluginOptions","options","Object","assign","defaultOptions","buildPolyfill","pragma","replacement","visitor","Program","path","name","scope","generateUid","used","traverse","replaceIdentifier","getReplacement","t","identifier","unshiftContainer","ReferencedIdentifier","node","getBindingIdentifier","replaceWith"],"mappings":";;;;;;kBAsBe,UAAUA,GAAV,EAAeC,aAAf,EAA8B;AAC3C,MAAMC,UAAUC,OAAOC,MAAP,CAAc,EAAd,EAAkBC,cAAlB,EAAkCJ,aAAlC,CAAhB;AACA,MAAMK,gBAAgB,6BAASJ,QAAQK,MAAjB,CAAtB;AACA,MAAMC,cAAcN,QAAQM,WAA5B;;AAEA,SAAO;AACLC,aAAS;AACPC,aADO,YACEC,IADF,EACQ;AACb,YAAMC,OAAOD,KAAKE,KAAL,CAAWC,WAAX,CAAuB,SAAvB,CAAb;;AAEA,YAAIC,OAAO,KAAX;AACAJ,aAAKK,QAAL,CAAcC,iBAAd,EAAiC;AAC/BC,wBAD+B,cACb;AAChBH,mBAAO,IAAP;AACA,mBAAOI,EAAEC,UAAF,CAAaR,IAAb,CAAP;AACD;AAJ8B,SAAjC;;AAOA,YAAIG,IAAJ,EAAU;AACRJ,eAAKU,gBAAL,CAAsB,MAAtB,EAA8Bf,cAAc;AAC1C,aAACE,WAAD,GAAeW,EAAEC,UAAF,CAAaR,IAAb;AAD2B,WAAd,CAA9B;AAGD;AACF;AAjBM;AADJ,GAAP;AAqBD,C;;AAhDD;;;;AACA;;IAAYO,C;;;;;;AAEZ,IAAMd,iBAAiB;AACrBE,qHADqB;AAKrBC;AALqB,CAAvB;;AAQA,IAAMS,oBAAoB;AACxBK,sBADwB,YACFX,IADE,EACI;AAAA,QAClBY,IADkB,GACFZ,IADE,CAClBY,IADkB;AAAA,QACZV,KADY,GACFF,IADE,CACZE,KADY;;;AAG1B,QAAIU,KAAKX,IAAL,KAAc,SAAlB,EAA6B;AAC7B,QAAIC,MAAMW,oBAAN,CAA2BD,KAAKX,IAAhC,CAAJ,EAA2C;;AAE3CD,SAAKc,WAAL,CAAiB,KAAKP,cAAL,EAAjB;AACD;AARuB,CAA1B","file":"index.js","sourcesContent":["import template from 'babel-template'\nimport * as t from 'babel-types'\n\nconst defaultOptions = {\n  pragma: `\n  var PROMISE = typeof Promise === 'undefined'\n    ? require('es6-promise').Promise\n    : Promise`,\n  replacement: `PROMISE`\n}\n\nconst replaceIdentifier = {\n  ReferencedIdentifier (path) {\n    const { node, scope } = path\n\n    if (node.name !== 'Promise') return\n    if (scope.getBindingIdentifier(node.name)) return\n\n    path.replaceWith(this.getReplacement())\n  }\n}\n\nexport default function (api, pluginOptions) {\n  const options = Object.assign({}, defaultOptions, pluginOptions)\n  const buildPolyfill = template(options.pragma)\n  const replacement = options.replacement\n\n  return {\n    visitor: {\n      Program (path) {\n        const name = path.scope.generateUid('Promise')\n\n        let used = false\n        path.traverse(replaceIdentifier, {\n          getReplacement () {\n            used = true\n            return t.identifier(name)\n          }\n        })\n\n        if (used) {\n          path.unshiftContainer('body', buildPolyfill({\n            [replacement]: t.identifier(name)\n          }))\n        }\n      }\n    }\n  }\n}\n"]}